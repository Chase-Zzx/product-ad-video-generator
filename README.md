# 商品广告视频生成器

一款基于 AI 的商品广告视频自动生成 Coze Skill。只需上传商品图片，即可自动完成从商品扣图、信息识别、脚本创作、分镜设计到视频生成、配音合成的全流程，输出专业级广告视频。

## 功能特点

| 功能模块 | 说明 |
|---------|------|
| 商品主体扣图 | 使用 rembg 自动去除背景，提取高质量透明 PNG 商品图 |
| 智能信息识别 | AI 视觉分析商品类型、颜色、材质、设计风格、卖点信息、品牌调性 |
| 广告脚本创作 | 自动生成符合 280-320 字/分钟语速的专业广告文案 |
| 分镜设计 | 智能规划每个镜头的时长、画面、运镜、商品展示方式 |
| 视频 Prompt 生成 | 基于商品特征生成高质量视频生成提示词，确保商品形态 100% 还原 |
| AI 视频生成 | 调用视频生成 API 生成各分镜视频片段 |
| TTS 配音 | 一次性生成整段配音，保持语速均匀一致 |
| 后期合成 | 视频拼接 + TTS 叠加 + BGM 混音，输出完整广告视频 |

## 适用场景

- **电商营销** - 淘宝、京东、拼多多等平台商品推广视频
- **社交媒体** - 抖音、快手、小红书种草视频
- **品牌宣传** - 企业产品宣传片、品牌形象视频
- **直播带货** - 直播间商品介绍视频素材

## 工作流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        第一阶段：商品处理                         │
├─────────────────────────────────────────────────────────────────┤
│  上传商品图片 → 主体扣图 → 信息识别 → 补充询问（可选）            │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        第二阶段：创意设计                         │
├─────────────────────────────────────────────────────────────────┤
│  广告脚本创作 → 分镜设计 → 视频 Prompt 生成                       │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        第三阶段：内容生成                         │
├─────────────────────────────────────────────────────────────────┤
│                    ┌─────────────────┐                          │
│   视频生成线：     │ 并行生成视频片段 │ → 视频片段收集            │
│                    └─────────────────┘                          │
│                             ↓                                   │
│   配音生成线：     整段 TTS 配音生成（必须在视频生成完成后）       │
└─────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────┐
│                        第四阶段：后期合成                         │
├─────────────────────────────────────────────────────────────────┤
│  视频拼接 → TTS 叠加 → BGM 混音 → 质量检查 → 输出最终视频         │
└─────────────────────────────────────────────────────────────────┘
```

## 环境配置

### 1. 安装 Python 依赖

```bash
pip install rembg==2.0.50 moviepy==1.0.3 Pillow==10.0.0
```

### 2. 配置环境变量

复制 `.env.example` 为 `.env` 并填入你的 API 密钥：

```bash
cp .env.example .env
```

```env
# 视频生成 API 配置
VIDEO_API_KEY=your_api_key_here
VIDEO_API_URL=your_api_endpoint_here
```

### 3. 创建输出目录

```bash
mkdir -p temp_output/videos
mkdir -p temp_output/audio
mkdir -p temp_output/final
```

## 项目结构

```
product-video-ads/
├── SKILL.md                      # Skill 主文件（完整流程说明）
├── README.md                     # 项目说明文档
├── .env.example                  # 环境变量模板
│
├── scripts/                      # 核心脚本
│   ├── remove_background.py      # 商品主体扣图
│   ├── generate_video.py         # AI 视频生成
│   └── merge_video.py            # 视频拼接与音频合成
│
├── references/                   # 参考文档
│   ├── script-template.md        # 广告脚本模板（含语速规范）
│   ├── storyboard-format.md      # 分镜格式规范
│   └── video-prompt-guide.md     # 视频 Prompt 编写指南
│
└── assets/                       # 资源文件
    └── bgm/                      # BGM 素材库（按风格分类）
```

## 脚本使用说明

### 1. 商品扣图 - `remove_background.py`

从商品图片中去除背景，提取透明 PNG 主体图。

```bash
python scripts/remove_background.py \
  --input ./product.jpg \
  --output ./product_no_bg.png
```

| 参数 | 说明 |
|------|------|
| `--input` | 输入商品图片路径 |
| `--output` | 输出透明 PNG 路径 |

### 2. 视频生成 - `generate_video.py`

调用 AI 视频生成 API，根据 Prompt 和商品图生成视频片段。

```bash
python scripts/generate_video.py \
  --prompt "商品展示视频的详细描述..." \
  --product-image ./product_no_bg.png \
  --duration 5 \
  --output ./temp_output/videos/segment_01.mp4 \
  --api-key $VIDEO_API_KEY \
  --api-url $VIDEO_API_URL
```

| 参数 | 说明 |
|------|------|
| `--prompt` | 视频生成 Prompt（仅包含视觉元素，不含台词） |
| `--product-image` | 商品扣图路径 |
| `--duration` | 视频时长（秒） |
| `--output` | 输出视频路径 |
| `--api-key` | 视频生成 API 密钥 |
| `--api-url` | 视频生成 API 端点 |

### 3. 视频合成 - `merge_video.py`

将多个视频片段拼接，并叠加 TTS 配音和 BGM 背景音乐。

```bash
python scripts/merge_video.py \
  --video-segments '["segment_01.mp4", "segment_02.mp4", "segment_03.mp4"]' \
  --tts-audio ./temp_output/audio/narration.wav \
  --bgm ./assets/bgm/upbeat.mp3 \
  --output ./temp_output/final/ad_video.mp4 \
  --bgm-volume 0.3
```

| 参数 | 说明 |
|------|------|
| `--video-segments` | 视频片段列表（JSON 格式） |
| `--tts-audio` | TTS 配音文件路径 |
| `--bgm` | BGM 文件路径（可选） |
| `--output` | 最终视频输出路径 |
| `--bgm-volume` | BGM 音量（0.1-1.0，默认 0.3） |

## 使用示例

### 示例 1：15 秒数码产品广告

```
商品：智能手表
时长：15 秒
风格：科技感、专业
受众：25-35 岁职场人士
```

生成流程：
1. 扣图并识别手表特征（材质、功能、设计）
2. 生成脚本：开场科技感氛围 → 多角度外观展示 → 健康监测功能卖点 → 品牌 Slogan
3. 设计 3-4 个分镜
4. 选择专业女声 TTS + 节奏感 BGM
5. 生成视频片段并合成

### 示例 2：30 秒时尚服装广告

```
商品：春装连衣裙
时长：30 秒
风格：时尚、清新
受众：20-30 岁女性
```

生成流程：
1. 扣图并识别服装特征（颜色、款式、面料）
2. 生成脚本：春日氛围开场 → 模特试穿效果 → 舒适透气卖点 → 购买引导
3. 设计 5-6 个分镜
4. 选择亲切女声 TTS + 轻快 BGM
5. 生成视频片段并合成

### 示例 3：60 秒家居产品广告

```
商品：智能扫地机器人
时长：60 秒
风格：温馨、科技
受众：家庭用户
```

生成流程：
1. 扣图并识别产品功能点
2. 生成脚本：家庭场景开场 → 产品外观与操作 → 智能路径/静音运行卖点 → 不同家庭环境应用 → 优惠信息
3. 设计 8-10 个分镜
4. 选择专业男声 TTS + 温馨 BGM
5. 生成视频片段并合成

## 核心设计原则

### 视频生成与 TTS 配音完全独立

```
视频生成线（只包含视觉元素）：
脚本 → 分镜 → Prompt → 生成视频 → 收集片段

TTS 配音线（只包含台词）：
脚本 → 提取完整台词 → 一次性生成整段 TTS

最终合成：
拼接视频 + 整段 TTS + BGM → 输出
```

### 商品形态 100% 还原

- 禁止任何形式的商品变形、扭曲、拉伸
- 禁止不合理的动态效果（如食品喷射液体等）
- 通过运镜、打光、场景增强展示，而非改变商品本身
- 推荐运镜：往前推、旋转、平移、环绕、静止

### TTS 语速规范

- 标准语速：280-320 字/分钟
- 必须一次性生成整段音频，禁止分段拼接
- 确保语速均匀一致，旁白连续流畅

## 在 Coze 中使用

1. 在 Coze 平台创建新 Bot
2. 将此项目作为 Skill 导入
3. 上传商品图片并描述你的需求
4. AI 将自动完成全流程并输出最终视频

## License

MIT
